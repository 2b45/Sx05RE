From b9a7d68e2a5f9fb8bec7fdd240cc4ad03aab07fc Mon Sep 17 00:00:00 2001
From: kszaq <kszaquitto@gmail.com>
Date: Fri, 3 Mar 2017 22:15:38 +0100
Subject: [PATCH] TEMP: S912: don't allow resolutions different than 1920x1080
 framebuffer size

---
 xbmc/windowing/egl/EGLNativeTypeAmlogic.cpp | 50 ++++-------------------------
 xbmc/windowing/egl/EGLNativeTypeAmlogic.h   |  4 ---
 2 files changed, 7 insertions(+), 47 deletions(-)

diff --git a/xbmc/windowing/egl/EGLNativeTypeAmlogic.cpp b/xbmc/windowing/egl/EGLNativeTypeAmlogic.cpp
index da46507..f6676f0 100644
--- a/xbmc/windowing/egl/EGLNativeTypeAmlogic.cpp
+++ b/xbmc/windowing/egl/EGLNativeTypeAmlogic.cpp
@@ -185,7 +176,9 @@ bool CEGLNativeTypeAmlogic::ProbeResolutions(std::vector<RESOLUTION_INFO> &resol
   for (std::vector<std::string>::const_iterator i = probe_str.begin(); i != probe_str.end(); ++i)
   {
     if(aml_mode_to_resolution(i->c_str(), &res))
-      resolutions.push_back(res);
+    if(res.iWidth == 1920 && res.iHeight == 1080)
+    {
+        resolutions.push_back(res);
 
     switch ((int)res.fRefreshRate)
     {
@@ -198,6 +191,7 @@ bool CEGLNativeTypeAmlogic::ProbeResolutions(std::vector<RESOLUTION_INFO> &resol
         resolutions.push_back(res);
         break;
     }
+    }
   }
   return resolutions.size() > 0;
 
@@ -208,8 +202,8 @@ bool CEGLNativeTypeAmlogic::GetPreferredResolution(RESOLUTION_INFO *res) const
   // check display/mode, it gets defaulted at boot
   if (!GetNativeResolution(res))
   {
-    // punt to 720p if we get nothing
-    aml_mode_to_resolution("720p", res);
+    // punt to 1080p if we get nothing
+    aml_mode_to_resolution("1080p60hz", res);
   }
 
   return true;
